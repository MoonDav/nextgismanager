<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>wxGIS: Create your own geoprocessing tool</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="page_container">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" style="width: 100%;">
 <tbody>
 <tr>
  <td id="projectlogo">
    <a href="http://wxgis.googlecode.com/" target="_new">
      <img alt="wxGIS" src="logo_cut.png"/>
    </a>
  </td>
  <td style="padding-left: 0.5em; text-align: right;">
   <span id="projectnumber">Version: 0.5.0</span>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('overview_gp_create_tool.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Create your own geoprocessing tool </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#overview_gp_create_tool_prepare">The preparation</a></li>
<li class="level1"><a href="#overview_gp_create_tool_skeleton">The creation of a tool skeleton</a></li>
<li class="level1"><a href="#overview_gp_create_tool_function">Implementing tool functionality</a></li>
<li class="level1"><a href="#overview_gp_create_tool_add2toolbox">Add to the toolbox</a></li>
</ul>
</div>
<div class="textblock"><p>A guide to creating own geoprocessing tool and adding it to the wxGISToolbox. The tool is a class inherited from the base class <a class="el" href="classwx_g_i_s_g_p_tool.html">wxGISGPTool</a>. The compiled tool is a dynamic link library (DLL). The library can consist one or several tools.</p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="classwx_g_i_s_g_p_tool.html">wxGISGPTool</a>, IGPTool</dd></dl>
<h1><a class="anchor" id="overview_gp_create_tool_prepare"></a>
The preparation</h1>
<p>We will demonstrate creating the new tool on simple tool which compute raster file statistics.</p>
<p>To create your own tool you need to create the new project in your favourite IDE. The CmakeLists.txt file for such project can be looks like:</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000009">Todo:</a></b></dt><dd>Add link to cmakes files in repository</dd></dl>
<div class="fragment"><div class="line">cmake_minimum_required (VERSION 2.8)</div>
<div class="line">project (wxgisgpcompstattool)</div>
<div class="line"></div>
<div class="line">set(LIB_NAME wxgisgpcompstattool)</div>
<div class="line"></div>
<div class="line">set(CMAKE_CONFIGURATION_TYPES &quot;Debug;Release&quot; CACHE STRING &quot;Configs&quot; FORCE)</div>
<div class="line">set(CMAKE_COLOR_MAKEFILE ON)</div>
<div class="line"></div>
<div class="line">include_directories(${CMAKE_CURRENT_SOURCE_DIR})</div>
<div class="line">include_directories(${CMAKE_CURRENT_BINARY_DIR})</div>
<div class="line">include_directories(${CMAKE_CURRENT_SOURCE_DIR}/include)</div>
<div class="line"></div>
<div class="line"># set path to additional CMake modules</div>
<div class="line">set(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake ${CMAKE_MODULE_PATH})</div>
<div class="line"></div>
<div class="line"># For windows, <span class="keywordflow">do</span> not allow the compiler to use <span class="keywordflow">default</span> target (Vista).</div>
<div class="line">if(WIN32)</div>
<div class="line">  add_definitions(-D_WIN32_WINNT=0x0501)</div>
<div class="line">endif(WIN32)</div>
<div class="line"></div>
<div class="line">add_definitions(-DSTRICT)</div>
<div class="line"></div>
<div class="line">if(MSVC)</div>
<div class="line">    if(CMAKE_CL_64)</div>
<div class="line">        set_target_properties(${the_target} PROPERTIES STATIC_LIBRARY_FLAGS <span class="stringliteral">&quot;/machine:x64&quot;</span>)</div>
<div class="line">        add_definitions(-D_WIN64)</div>
<div class="line">    endif()</div>
<div class="line">endif()</div>
<div class="line"></div>
<div class="line">if(UNIX)</div>
<div class="line">     if(CMAKE_COMPILER_IS_GNUCXX OR CV_ICC)</div>
<div class="line">        set(CMAKE_C_FLAGS &quot;${CMAKE_C_FLAGS} -fPIC -fno-strict-aliasing<span class="stringliteral">&quot;)</span></div>
<div class="line"><span class="stringliteral">        set(CMAKE_CXX_FLAGS &quot;</span>${CMAKE_CXX_FLAGS} -fPIC -fno-strict-aliasing<span class="stringliteral">&quot;)</span></div>
<div class="line"><span class="stringliteral">     endif()</span></div>
<div class="line"><span class="stringliteral">endif()    </span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">set(wxWidgets_EXCLUDE_COMMON_LIBRARIES ON)</span></div>
<div class="line"><span class="stringliteral">find_package(wxWidgets COMPONENTS base xml REQUIRED)</span></div>
<div class="line"><span class="stringliteral"># wxWidgets include (this will do all the magic to configure everything)</span></div>
<div class="line"><span class="stringliteral">if(wxWidgets_FOUND)</span></div>
<div class="line"><span class="stringliteral">    include(${wxWidgets_USE_FILE})</span></div>
<div class="line"><span class="stringliteral">endif(wxWidgets_FOUND)</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">find_package(WXGIS COMPONENTS core catalog geoprocessing REQUIRED)</span></div>
<div class="line"><span class="stringliteral">if(WXGIS_FOUND)</span></div>
<div class="line"><span class="stringliteral">    include_directories(${WXGIS_INCLUDE_DIR})</span></div>
<div class="line"><span class="stringliteral">endif(WXGIS_FOUND)</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">#find needed packages</span></div>
<div class="line"><span class="stringliteral">find_package(GDAL REQUIRED)</span></div>
<div class="line"><span class="stringliteral">if(GDAL_FOUND)</span></div>
<div class="line"><span class="stringliteral">    include_directories(${GDAL_INCLUDE_DIR})</span></div>
<div class="line"><span class="stringliteral">    include_directories(${GDAL_INCLUDE_DIR}/ogr)</span></div>
<div class="line"><span class="stringliteral">    include_directories(${GDAL_INCLUDE_DIR}/ogr/ogrsf_frmts)</span></div>
<div class="line"><span class="stringliteral">    include_directories(${GDAL_INCLUDE_DIR}/port)</span></div>
<div class="line"><span class="stringliteral">    include_directories(${GDAL_INCLUDE_DIR}/gcore)</span></div>
<div class="line"><span class="stringliteral">    include_directories(${GDAL_INCLUDE_DIR}/alg)</span></div>
<div class="line"><span class="stringliteral">    include_directories(${GDAL_INCLUDE_DIR}/frmts/vrt)</span></div>
<div class="line"><span class="stringliteral">    include_directories(${GDAL_INCLUDE_DIR}/build/port) #assume that out of source build was in build dir</span></div>
<div class="line"><span class="stringliteral">endif(GDAL_FOUND)</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">set(PROJECT_HHEADERS ${PROJECT_HHEADERS}</span></div>
<div class="line"><span class="stringliteral">    ${LIB_HEADERS}/gpcompstattool.h</span></div>
<div class="line"><span class="stringliteral">)</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">set(PROJECT_CSOURCES ${PROJECT_CSOURCES}</span></div>
<div class="line"><span class="stringliteral">    ${LIB_SOURCES}/gpcompstattool.cpp</span></div>
<div class="line"><span class="stringliteral">)</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">add_library(${LIB_NAME} SHARED ${PROJECT_HHEADERS} ${PROJECT_CSOURCES})</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">if(wxWidgets_FOUND)</span></div>
<div class="line"><span class="stringliteral">   target_link_libraries(${LIB_NAME} ${wxWidgets_LIBRARIES})</span></div>
<div class="line"><span class="stringliteral">endif(wxWidgets_FOUND)</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">if(WXGIS_FOUND)</span></div>
<div class="line"><span class="stringliteral">   target_link_libraries(${LIB_NAME} ${WXGIS_LIBRARIES})</span></div>
<div class="line"><span class="stringliteral">endif(WXGIS_FOUND)</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">if(GDAL_FOUND)</span></div>
<div class="line"><span class="stringliteral">    target_link_libraries(${LIB_NAME} ${GDAL_LIBRARIES})</span></div>
<div class="line"><span class="stringliteral">endif(GDAL_FOUND) </span></div>
</div><!-- fragment --><h1><a class="anchor" id="overview_gp_create_tool_skeleton"></a>
The creation of a tool skeleton</h1>
<p>To create your own tool you need to inherit the class from <a class="el" href="classwx_g_i_s_g_p_tool.html">wxGISGPTool</a> and reimplement need methods. The header file maybe look like this:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>WXDLLIMPEXP_GIS_GP <a class="code" href="classwx_g_i_s_g_p_comp_stat_tool.html">wxGISGPCompStatTool</a> : </div>
<div class="line">    <span class="keyword">public</span> <a class="code" href="classwx_g_i_s_g_p_tool.html">wxGISGPTool</a></div>
<div class="line">{</div>
<div class="line">   DECLARE_DYNAMIC_CLASS(<a class="code" href="classwx_g_i_s_g_p_comp_stat_tool.html">wxGISGPCompStatTool</a>)</div>
<div class="line"></div>
<div class="line">public:</div>
<div class="line">    <a class="code" href="classwx_g_i_s_g_p_comp_stat_tool.html">wxGISGPCompStatTool</a>(<span class="keywordtype">void</span>);</div>
<div class="line">    virtual ~<a class="code" href="classwx_g_i_s_g_p_comp_stat_tool.html">wxGISGPCompStatTool</a>(<span class="keywordtype">void</span>);</div>
<div class="line">    <span class="comment">//IGPTool</span></div>
<div class="line">    virtual const wxString GetDisplayName(<span class="keywordtype">void</span>);</div>
<div class="line">    virtual const wxString GetName(<span class="keywordtype">void</span>);</div>
<div class="line">    virtual const wxString GetCategory(<span class="keywordtype">void</span>);</div>
<div class="line">    virtual <span class="keywordtype">bool</span> Execute(<a class="code" href="class_i_track_cancel.html">ITrackCancel</a>* pTrackCancel);</div>
<div class="line">    virtual GPParameters GetParameterInfo(<span class="keywordtype">void</span>);</div>
<div class="line">};</div>
</div><!-- fragment --><p>The only need to reimplement methods is present.</p>
<h1><a class="anchor" id="overview_gp_create_tool_function"></a>
Implementing tool functionality</h1>
<p>The source file maybe look like this:</p>
<div class="fragment"><div class="line">IMPLEMENT_DYNAMIC_CLASS(<a class="code" href="classwx_g_i_s_g_p_comp_stat_tool.html">wxGISGPCompStatTool</a>, <a class="code" href="classwx_g_i_s_g_p_tool.html">wxGISGPTool</a>)</div>
<div class="line"></div>
<div class="line"><a class="code" href="classwx_g_i_s_g_p_comp_stat_tool.html">wxGISGPCompStatTool</a>::<a class="code" href="classwx_g_i_s_g_p_comp_stat_tool.html">wxGISGPCompStatTool</a>(<span class="keywordtype">void</span>) : <a class="code" href="classwx_g_i_s_g_p_tool.html">wxGISGPTool</a>()</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">wxGISGPCompStatTool::~wxGISGPCompStatTool(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> wxString <a class="code" href="classwx_g_i_s_g_p_comp_stat_tool.html#a1733393c6ba005505c64a6e8fefe2e3f">wxGISGPCompStatTool::GetDisplayName</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> wxString(_(<span class="stringliteral">&quot;Compute statistics&quot;</span>));</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> wxString <a class="code" href="classwx_g_i_s_g_p_comp_stat_tool.html#afe466c6cdc03a2144d8b3d4e4f030d7f">wxGISGPCompStatTool::GetName</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> wxString(wxT(<span class="stringliteral">&quot;comp_stats&quot;</span>));</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> wxString <a class="code" href="classwx_g_i_s_g_p_comp_stat_tool.html#af5734e1a3495c341b73b568a8587afaf">wxGISGPCompStatTool::GetCategory</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> wxString(_(<span class="stringliteral">&quot;Data Management Tools/Raster&quot;</span>));</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">GPParameters <a class="code" href="classwx_g_i_s_g_p_comp_stat_tool.html#a12a54def0df0caf195f7e8624c4dfdc7">wxGISGPCompStatTool::GetParameterInfo</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span>(m_paParam.IsEmpty())</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//src path</span></div>
<div class="line">        <a class="code" href="classwx_g_i_s_g_p_parameter.html">wxGISGPParameter</a>* pParam1 = <span class="keyword">new</span> <a class="code" href="classwx_g_i_s_g_p_parameter.html">wxGISGPParameter</a>();</div>
<div class="line">        pParam1-&gt;SetName(wxT(<span class="stringliteral">&quot;src_path&quot;</span>));</div>
<div class="line">        pParam1-&gt;SetDisplayName(_(<span class="stringliteral">&quot;Source raster&quot;</span>));</div>
<div class="line">        pParam1-&gt;SetParameterType(enumGISGPParameterTypeRequired);</div>
<div class="line">        pParam1-&gt;SetDataType(enumGISGPParamDTPath);</div>
<div class="line">        pParam1-&gt;SetDirection(enumGISGPParameterDirectionInput);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classwx_g_i_s_g_p_gx_object_domain.html">wxGISGPGxObjectDomain</a>* pDomain1 = <span class="keyword">new</span> <a class="code" href="classwx_g_i_s_g_p_gx_object_domain.html">wxGISGPGxObjectDomain</a>();</div>
<div class="line">        pDomain1-&gt;AddFilter(<span class="keyword">new</span> <a class="code" href="classwx_gx_dataset_filter.html">wxGxDatasetFilter</a>(enumGISRasterDataset));</div>
<div class="line">        pParam1-&gt;SetDomain(pDomain1);</div>
<div class="line"></div>
<div class="line">        m_paParam.Add(static_cast&lt;IGPParameter*&gt;(pParam1));</div>
<div class="line"></div>
<div class="line">        <span class="comment">//build approx</span></div>
<div class="line">        <a class="code" href="classwx_g_i_s_g_p_parameter.html">wxGISGPParameter</a>* pParam2 = <span class="keyword">new</span> <a class="code" href="classwx_g_i_s_g_p_parameter.html">wxGISGPParameter</a>();</div>
<div class="line">        pParam2-&gt;SetName(wxT(<span class="stringliteral">&quot;approx_ok&quot;</span>));</div>
<div class="line">        pParam2-&gt;SetDisplayName(_(<span class="stringliteral">&quot;Compute statistics based on overviews or a subset of all tiles&quot;</span>));</div>
<div class="line">        pParam2-&gt;SetParameterType(enumGISGPParameterTypeOptional);</div>
<div class="line">        pParam2-&gt;SetDataType(enumGISGPParamDTBool);</div>
<div class="line">        pParam2-&gt;SetDirection(enumGISGPParameterDirectionInput);</div>
<div class="line">        pParam2-&gt;SetValue(<span class="keyword">false</span>);</div>
<div class="line"></div>
<div class="line">        m_paParam.Add(static_cast&lt;IGPParameter*&gt;(pParam2));</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> m_paParam;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> <a class="code" href="classwx_g_i_s_g_p_comp_stat_tool.html#a391610dcf23a9c7b5f652e0d868435bd">wxGISGPCompStatTool::Execute</a>(<a class="code" href="class_i_track_cancel.html">ITrackCancel</a>* pTrackCancel)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span>(!<a class="code" href="classwx_g_i_s_g_p_comp_stat_tool.html#acf3b4a5ba21c99ab6168d721abb2c983">Validate</a>())</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//add messages to pTrackCancel</span></div>
<div class="line">        <span class="keywordflow">if</span>(pTrackCancel)</div>
<div class="line">            pTrackCancel-&gt;PutMessage(_(<span class="stringliteral">&quot;Unexpected error occurred&quot;</span>), -1, enumGISMessageErr);</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="class_i_gx_object_container.html">IGxObjectContainer</a>* pGxObjectContainer = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_i_gx_object_container.html">IGxObjectContainer</a>*<span class="keyword">&gt;</span>(m_pCatalog);</div>
<div class="line">    <span class="keywordflow">if</span>(!pGxObjectContainer)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>(pTrackCancel)</div>
<div class="line">            pTrackCancel-&gt;PutMessage(_(<span class="stringliteral">&quot;Error getting catalog object&quot;</span>), -1, enumGISMessageErr);</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    wxString sSrcPath = m_paParam[0]-&gt;GetValue();</div>
<div class="line">    IGxObject* pGxObject = pGxObjectContainer-&gt;SearchChild(sSrcPath);</div>
<div class="line">    <span class="keywordflow">if</span>(!pGxObject)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>(pTrackCancel)</div>
<div class="line">            pTrackCancel-&gt;PutMessage(_(<span class="stringliteral">&quot;Error getting source object&quot;</span>), -1, enumGISMessageErr);</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="class_i_gx_dataset.html">IGxDataset</a>* pGxDataset = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_i_gx_dataset.html">IGxDataset</a>*<span class="keyword">&gt;</span>(pGxObject);</div>
<div class="line">    <span class="keywordflow">if</span>(!pGxDataset)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>(pTrackCancel)</div>
<div class="line">            pTrackCancel-&gt;PutMessage(_(<span class="stringliteral">&quot;Source object is of incompatible type&quot;</span>), -1, enumGISMessageErr);</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    wxGISRasterDatasetSPtr pSrcDataSet = boost::dynamic_pointer_cast&lt;<a class="code" href="classwx_g_i_s_raster_dataset.html">wxGISRasterDataset</a>&gt;(pGxDataset-&gt;GetDataset());</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(!pSrcDataSet)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>(pTrackCancel)</div>
<div class="line">            pTrackCancel-&gt;PutMessage(_(<span class="stringliteral">&quot;Source dataset is of incompatible type&quot;</span>), -1, enumGISMessageErr);</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(!pSrcDataSet-&gt;Open(<span class="keyword">false</span>))</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">    GDALDataset* poGDALDataset = pSrcDataSet-&gt;GetRaster();</div>
<div class="line">    <span class="keywordflow">if</span>(!poGDALDataset)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>(pTrackCancel)</div>
<div class="line">            pTrackCancel-&gt;PutMessage(_(<span class="stringliteral">&quot;Error getting raster&quot;</span>), -1, enumGISMessageErr);</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> bApproxOK = m_paParam[1]-&gt;GetValue();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> nBand = 0; nBand &lt; poGDALDataset-&gt;GetRasterCount(); nBand++ )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">double</span>      dfMin(0), dfMax(255), dfMean(127), dfStdDev(2);</div>
<div class="line">        CPLErr      eErr;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(pTrackCancel)</div>
<div class="line">            pTrackCancel-&gt;PutMessage(wxString::Format(_(<span class="stringliteral">&quot;Proceed band %d&quot;</span>), nBand + 1), -1, enumGISMessageInfo);</div>
<div class="line">        GDALRasterBand* pBand = poGDALDataset-&gt;GetRasterBand(nBand + 1);</div>
<div class="line">        eErr = pBand-&gt;ComputeStatistics(bApproxOK, &amp;dfMin, &amp;dfMax, &amp;dfMean, &amp;dfStdDev, ExecToolProgress, (<span class="keywordtype">void</span>*)pTrackCancel);   </div>
<div class="line">        <span class="keywordflow">if</span>(eErr != CE_None)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span>(pTrackCancel)</div>
<div class="line">            {</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">char</span>* pszErr = CPLGetLastErrorMsg();</div>
<div class="line">                pTrackCancel-&gt;PutMessage(wxString::Format(_(<span class="stringliteral">&quot;ComputeStatistics failed! GDAL error: %s&quot;</span>), wxString(pszErr, wxConvUTF8).c_str()), -1, enumGISMessageErr);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">        pTrackCancel-&gt;PutMessage(wxString::Format(_(<span class="stringliteral">&quot;Band %d: min - %.2f, max - %.2f, mean - %.2f, StdDev - %.2f&quot;</span>), nBand + 1, dfMin, dfMax, dfMean, dfStdDev), -1, enumGISMessageNorm);</div>
<div class="line"></div>
<div class="line">    pSrcDataSet-&gt;SetHasStatistics(<span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>In function <b>GetDisplayName</b> we returns the tool name, which will be shown in user interface (toolbox and other controls). This name can be repeated (not recommended).</p>
<p>The <b>GetName</b> returns the internal name. This name should be unique.</p>
<p>The <b>GetCategory</b> returns the category name with subcategories. The subcategories divided by "/".</p>
<p>The <b>GetParameterInfo</b> return the array of parameters. In our case there are two parameters:</p>
<ol type="1">
<li>Source raster</li>
<li>Compute statistics based on overviews or a subset of all tiles</li>
</ol>
<p>The first parameter is the type of <code>choose</code> <code>path</code> and second <code>checkbox</code>.</p>
<p>The <b>Execute</b> do all the work and returns <span class="literal">true</span> on success and <span class="literal">false</span> vice versa.</p>
<h1><a class="anchor" id="overview_gp_create_tool_add2toolbox"></a>
Add to the toolbox</h1>
<p>After you successfully create and compile tool you need add it to the wxGIS toolbox.</p>
<p>To do it, you need:</p>
<ol type="1">
<li>Add library path (absolute or relative) to the &lt;libs&gt; section of wxGISCommon.xml config file.</li>
<li>Add class name and tool internal name (the same name as you set in <code>GetName</code> function) to the &lt;tools&gt; section of wxGISToolbox.xml config file.</li>
<li>Put internal name to the &lt;toolboxes&gt; section in appropriate &lt;toolbox&gt; subsection of wxGISToolbox.xml config file.</li>
</ol>
<p>The special console tool which will do it automatically is planned. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Documentation</a></li><li class="navelem"><a class="el" href="page_topics.html">Topic Overviews</a></li>
    <li class="footer">Generated on Mon Oct 28 2013 04:47:53 for wxGIS by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
